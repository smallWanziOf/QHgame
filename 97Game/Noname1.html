<!doctype html>
 <head>
  <meta charset="UTF-8">
  <title>Document</title>
 </head>
 <body>
  <div id="tang">
	<p class="imgC"></p>
	<p class="resultB"></p>
  </div>
 </body>
 <script src="jquery-1.11.3.js"></script>
 <script>
	var data1=[
	{"roleid":3,"attack":125,"define":67,"life":840},
	{"roleid":20,"attack":88,"define":87,"life":800}];
	var data2=[{"roleid":4,"attack":110,"define":57,"life":800},
	{"roleid":13,"attack":115,"define":87,"life":840},
	{"roleid":23,"attack":88,"define":58,"life":800}];
	var battleIndex1=0;
	var battleIndex2=0;
	var battleLength1=data1.length;
	var battleLength2=data2.length;
	var startBattle={
		zhan1:null,
		zhan2:null,
		timer:null,
		win:false,
		init:function(n1,n2){
			this.zhan1=n1;
			this.zhan2=n2;
			//显示当前的对战的人的图片
			var strImg='';
			strImg+="<img src='showAllRole/"+this.zhan1['roleid']+".jpg' /><img src='showAllRole/"+this.zhan2['roleid']+".jpg' />";
			$(".imgC").append(strImg);
			//3秒执行一次对战
			this.timer=setInterval(this.start1.bind(this),1000);
		},
		start1:function(){
			//存放乙方攻击的内容
			var strBattle1='<b>乙方造成</b>';
			//存放敌方攻击的内容
			var strBattle2='<b>敌方造成</b>';
			//attack1乙方的基础攻击属性
			var attack1=this.zhan1['attack'];
			//attack2敌方的基础攻击属性
			var attack2=this.zhan2['attack'];
			//随机增加乙方攻击力
			var randAttack1=Math.floor(Math.random()*50);
			//随机增加敌方攻击力
			var randAttack2=Math.floor(Math.random()*50);
			//改变乙方的攻击力+随机增加的攻击力
			attack1+=randAttack1;
			//改变敌方的攻击力+随机增加的攻击力
			attack2+=randAttack2;
			//获取乙方生命值
			var life1=this.zhan1['life'];
			//获取敌方生命值
			var life2=this.zhan2['life'];
			//获取乙方防御力并削弱乘0.6
			var define1=Math.floor(this.zhan1['define']*0.6);
			//获取敌方防御力并削弱乘0.6
			var define2=Math.floor(this.zhan2['define']*0.6);
			//乙方攻击的条件
			if(life2+define2>attack1){
				if(parseInt(attack1-define2)<=0){
					this.zhan2['life']=life2-1;
					strBattle1+="<p>1点伤害!敌方剩余"+this.zhan2['life']+"点生命值</p>";
				}else{
					this.zhan2['life']=life2-(attack1-define2);
					strBattle1+="<p>"+parseInt(attack1-define2)+"点伤害!敌方剩余"+this.zhan2['life']+"点生命值</p>";
				}
				$(".resultB").append(strBattle1);
			}else{
				strBattle1+="<p style='color:red'>"+parseInt(attack1)+"点伤害!敌方阵亡</p>";
				$(".resultB").append(strBattle1);
				clearInterval(this.timer);
				this.timer=null;
				data1[battleIndex1]['life']=this.zhan1['life'];
				var Index2=++battleIndex2;
				if(Index2<battleLength2){
					battleTeam(battleIndex1,Index2);
				}else{
					$(".resultB").append("<h2>恭喜！挑战胜利！</h2>");
					return;
				}
			}
			//敌方攻击的条件
			if(life1+define1>attack2){
				if(parseInt(attack2-define1)<=0){
					debugger;
					this.zhan1['life']=life1-1;
					strBattle2+="<p>1点伤害!乙方剩余"+this.zhan1['life']+"点生命值</p>";
				}else{
					debugger;
					this.zhan1['life']=life1-(attack2-define1);
					strBattle2+="<p>"+parseInt(attack2-define1)+"点伤害!乙方剩余"+this.zhan1['life']+"点生命值</p>";
				}				
				$(".resultB").append(strBattle2);
			}else{
				strBattle2+="<p style='color:red'>"+parseInt(attack2)+"点伤害!乙方阵亡</p>";
				$(".resultB").append(strBattle2);
				clearInterval(this.timer);
				this.timer=null;
				data2[battleIndex2]['life']=this.zhan2['life'];
				var Index1=++battleIndex1;
				if(Index1<battleLength1){	
					battleTeam(Index1,battleIndex2);
				}else{
					$(".resultB").append("<h2>很遗憾。。。挑战失败</h2>");
					return;
				}
			}
		}
		
	}
	window.onload=function(){
		startBattle.init(data1[battleIndex1],data2[battleIndex2])
	}
	function battleTeam(n1,n2){
		startBattle.init(data1[n1],data2[n2]);
	}
 </script>
</html>
