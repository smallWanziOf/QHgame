<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>拳皇合卡</title>
    <!-- Bootstrap -->
    <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <script src="../encode.js"></script>
    <script src="../data/config.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .thumbnail{border:none;}
      .allRoleContainer .thumbnail>img{margin-left:0;}
      .allRoleContainer .thumbnail{background-color:#000;}
    </style>
  </head>
  <body class="selectRole-body">
    <!-- 我的个人新信息 -->
    <div class="modal fade bs-example-modal-sm" tabindex="-1" id="show_userMessage" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content" >
          <div class="container">
            <img src="../images/other/usermessage.jpg" alt="" style="margin:0 auto;position:relative;left:30px;">
            <h3>个人信息</h3>
            <h5>账户名称：<span id="sql_name"></span></h5>
            <h5>账户余额：<span id="sql_acount"></span></h5>
            <h5>队伍体力：<span id="sql_power"></span></h5>
            <h5>队伍数量：<span id="sql_Team"></span></h5>
            <h5>队伍战力：<span id="sql_combat"></span></h5>
            <h5>VIP 等级：<span id="sql_title"></span></h5>
          </div>
        </div>
      </div>
    </div>
  
    <!-- 我的队伍 -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" id="show_userTeam" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content"  style="text-align: center;">
          <div class="row" id="all_userTeam">
            
          </div>
        </div>
      </div>
    </div>

    <!-- 我的角色碎片 -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" id="show_userChip" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" style="text-align: center;">
          <div class="row" id="sql_showAllChip"></div>
        </div>
      </div>
    </div>

    <!-- 我的金币 -->
    <div class="modal fade bs-example-modal-sm" tabindex="-1" id="show_userGem" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content" style="text-align: center;">
          <div class="jumbotron" style="margin-bottom:0" >
            <img src="../images/other/money.jpg" id="payImg" style="width:100%;">
            <p>账户余额：<span id="sql_showAllMoney"></span></p>
            <p><a class="btn btn-primary btn-lg" id="payToWeiXin" role="button">给账户加油</a></p>
            <!--<p style="text-align: left;font-size: 18px;">
              * 10元=1000金<br/>
              * 50元=7000金 + 20个人物碎片<br/>
              * 100元=15000金+7800人物任选其一<br/>
              * 888元=188888金+炎之克里斯
            </p>
            <p>(请添加微信：1305226892)</p>-->
          </div>
        </div>
      </div>
    </div>

    <!-- 抽奖页面 -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" id="show_lottery" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" style="text-align: center;">
          <div class="row" id="sql_lottery" style="text-align: center;">
            <div class='col-sm-12 col-md-12' style='margin-top:20px'>
              <div class='thumbnail'>
                <div class='caption'>
                  <p>
                    <a class='btn btn-primary' role='button' id='lottery1'>抽一次</a>
                      &nbsp;&nbsp;&nbsp;
                    <a class='btn btn-primary' role='button' id='lottery10'>抽十次</a>
                  </p>
                  <h3 style='color:red'>必得已拥有人物碎片！有机会获得神秘人物</h3>
                  <p>(注：抽一次消耗 60金币,十连抽只需 550金币)</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 针对没有角色的用户的一种提示 -->
    <div class="modal fade bs-example-modal-sm" tabindex="-1" id="no_role" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content" >
          <h3 style="text-align: center;color:green;font-weight: bold;">欢迎进入'拳皇合卡'游戏</h3>
          <h3 style="text-align: center;color:green;font-weight: bold;">您的队伍目前空无一人....</h3>
          <h3 style="text-align: center;color:green;font-weight: bold;">您可以选择喜欢的人物角色加入自己的阵营</h3>
          <!-- <h3 style="text-align: center;color:green;font-weight: bold;">开始战斗吧</h3> -->
          <div style="text-align: center;">
            <img src="../images/dongzhang/benpao.jpg" alt="">
          </div>
        </div>
      </div>
    </div>
    
    <!-- 购买成功后的提示 -->
    <div class="modal fade bs-example-modal-sm" tabindex="-1" id="myModal" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm" id="buy_success">
      </div>
    </div>

    <!-- 查看人物的提示 -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" id="lookRoleDal" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" id="lookRole_Dal">
      </div>
    </div>

    <!-- 游戏帮助 -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" id="show_book" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" style="text-align: center;">
          <div class="row" id="sql_book" style="text-align: center;">
            <div class='col-sm-12 col-md-12' style='margin-top:20px'>
              <h3>拳皇97 合卡游戏玩法介绍</h3>
              <h5>(官方QQ群：605273753  微信：1305226892)</h5>
              <div style='text-align: left;padding-left: 100px;' class='query_help'>
                <p><1>首次登陆游戏可以获得888金币和100体力值，您可以用来购买对应价格的人物</p>       
                <p><2>游戏目前只支持三种方式获得碎片</p>
                <p style='margin-left: 20px;'><2.1>进入战斗选择“经典模式”可以进行与玩家对战获得出站人物的碎片</p>       
                <p style='margin-left: 20px;'><2.2>进入战斗选择“战斗模式”可以进行与玩家对战获得出站人物的碎片</p>       
                <p style='margin-left: 20px;'><2.3>可以选择进入抽奖页面进行抽奖或得人物碎片</p>       
                <p><3>拥有人物碎片后可以进行强化！来提高当前人物的属性</p>       
                <p><4>如果发现主页面商城中的人物角色太少不防试试“神秘商店”这里有你想要的</p>       
                <p><5>如果想要查看当前的人物属性或者其他的信息可以点击左边的导航进行查询</p>       
                <p><6>“战斗模式”中不仅可以得到相应的人物碎片还可以获得一定数量的金币</p>       
                <p><7>游戏中目前“修炼模式”还未开启，敬请期待下次的版本更新</p>       
                <p><8>加群送人物！</p> 
                <p><9>祝大家玩得愉快！欢迎大家提出宝贵的意见和建议！</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="mainRole" class="selectRole-mainRole">
      <span class="glyphicon glyphicon-user" id="P_message" data-toggle="tooltip" data-placement="right" title="我的信息">
      </span>
      <span class="glyphicon glyphicon-flag" id="P_team" data-toggle="tooltip" data-placement="right" title="我的队伍">
      </span>
      <span class="glyphicon glyphicon-th" id="P_chip" data-toggle="tooltip" data-placement="right" title="我的碎片">
      </span>
      <span class="glyphicon glyphicon-usd" id="P_gem" data-toggle="tooltip" data-placement="right" title="我的金币">
      </span>
      <span class="glyphicon glyphicon-fire" id="P_battle" data-toggle="tooltip" data-placement="right" title="开始战斗">
      </span>
      <span class="glyphicon glyphicon-home" id="P_index" data-toggle="tooltip" data-placement="right" title="返回主页">
      </span>
      <span class="glyphicon glyphicon-gift" id="P_gift" data-toggle="tooltip" data-placement="right" title="神秘商店">
      </span>
      <span class="glyphicon glyphicon-refresh" id="P_refresh" data-toggle="tooltip" data-placement="right" title="刷新页面">
      </span>
      <span class="glyphicon glyphicon-sunglasses" id="P_sunglasses" data-toggle="tooltip" data-placement="right" title="进入抽奖">
      </span>
      <span class="glyphicon glyphicon-book" id="P_book" data-toggle="tooltip" data-placement="right" title="查看帮助">
      </span>
    </div>
    <div class="container" >
      <div class="row allRoleContainer" style="margin-top:20px;">
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script>
      var user_location=window.location.search;
      var uName=hexToDec(user_location.substring(user_location.indexOf("_")+1));
      var data={"uName":uName}
      var hasCarId=[];

      //隐藏用户已有的人物
      $(document).ready(function(){
        $.ajax({
          type:"POST",
          data:data,
          url:"testUser.php",
          success:function(e){
            if(e=="error"){
              alert("迷之操作！！！请重新登录");
              window.location.href=dev_location;
            }
          },
          error:function(e){
            alert("迷之操作！！！请重新登录");
            window.location.href=dev_location;
          }
        })
        if(uName!=''){
          $.ajax({
            type:"POST",
            data:data,
            url :"selectRole.php",
            success:function(e){
              var carId=JSON.parse(e);
              if(carId.carid!=null){
                var allId=carId.carid.split(",");
                hasCarId=allId;
                if(hasCarId.length==1){
                  $("#no_role").modal();
                  return;
                }
                $.ajax({
                  type:"POST",
                  data:data,
                  url :"showAllRole.php",
                  success:function(e){
                    var data=JSON.parse(e);
                    var str='';
                    for(var i=0;i<data.length;i++){
                      if($.inArray(data[i].id,allId)==-1&&data[i].tradeprice<=6300){
                        str+='<div class="col-sm-6 col-md-4 hasParent" id='+data[i].roleid+'>'+
                              '<div class="thumbnail outCarImg">'+
                                '<img src="../images/showAllRole/'+data[i].roleid+'.jpg" class="img-responsive CarImg">'+
                                '<div class="caption RoleImg">'+
                                  '<h3 style="color:#fff;">'+data[i].rolename+'</h3>'+
                                  '<p>'+
                                    '<h5 style="color:#fff;">攻击：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roleattack+'%">'+data[i].roleattack+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">防御：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roledefense+'%">'+data[i].roledefense+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">生命值：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].rolelife/10+'%">'+data[i].rolelife+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">交易价：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"  style="min-width: 2em;width:'
                                    +data[i].tradeprice/100+'%">'+data[i].tradeprice+'</div></div>'+
                                    '</h5>'+
                                  '</p>'+
                                  '<p>'+
                                    '<a href="#" class="btn btn-primary Join_Team" role="button" >加入队伍</a>'+ 
                             		'<a href="#" class="btn btn-danger Look_Role" role="button" style="margin-left:20px;">查看属性</a>'+ 
                                  '</p>'+
                                '</div>'+
                              '</div>'+
                            '</div>'
                      }
                    }
                    $(".allRoleContainer").html(str)
                    $(".progress-bar").hover(function(){
                    	$(this).addClass("active")
                    },function(){
                    	$(this).removeClass("active")
                    })
                    /*翻拍效果*/
                    $(".allRoleContainer").on("mouseover",".CarImg",function(){
                        $(this).addClass("imgHover");
                        $(this).next('div').addClass("rotateImg");
                        $(this).css("opacity","0");
                    })
                    $("body").on("mouseover",function(e){
                        if(e.target.nodeName=="BODY"){
                        	$(".CarImg").removeClass("imgHover");
                            $(".RoleImg").removeClass("rotateImg");
                            $(".CarImg").css("opacity","1")
                        }              
                    })
                  },
                  error:function(e){
                    alert("程序出错请重试！")
                  }
                })
              }else{
                $("#P_book").trigger("click");
                $.ajax({
                  type:"POST",
                  data:data,
                  url :"showAllRole.php",
                  success:function(e){
                    var data=JSON.parse(e);
                    var str='';
                    for(var i=0;i<data.length;i++){
                      if(data[i].tradeprice<=6300){
                        str+='<div class="col-sm-6 col-md-4 hasParent" id='+data[i].roleid+'>'+
                              '<div class="thumbnail outCarImg">'+
                                '<img src="../images/showAllRole/'+data[i].roleid+'.jpg" class="img-responsive CarImg">'+
                                '<div class="caption RoleImg">'+
                                  '<h3 style="color:#fff;">'+data[i].rolename+'</h3>'+
                                  '<p>'+
                                    '<h5 style="color:#fff;">攻击：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"  style="width:'
                                    +data[i].roleattack+'%">'+data[i].roleattack+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">防御：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"  style="width:'
                                    +data[i].roledefense+'%">'+data[i].roledefense+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">生命值：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"  style="width:'
                                    +data[i].rolelife/10+'%">'+data[i].rolelife+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">交易价：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"  style="min-width: 2em;width:'
                                    +data[i].tradeprice/100+'%">'+data[i].tradeprice+'</div></div>'+
                                    '</h5>'+
                                  '</p>'+
                                  '<p>'+
                                    '<a href="#" class="btn btn-primary Join_Team" role="button" >加入队伍</a>'+ 
                            		'<a href="#" class="btn btn-danger Look_Role" role="button" style="margin-left:20px;">查看属性</a>'+
                                  '</p>'+
                                '</div>'+
                              '</div>'+
                            '</div>'
                      }
                    }
                    $(".allRoleContainer").html(str)
                    /*增加条形动画*/
                    $(".progress-bar").hover(function(){
                      $(this).addClass("active")
                    },function(){
                      $(this).removeClass("active")
                    })
					          /*翻拍效果*/
                    $(".allRoleContainer").on("mouseover",".CarImg",function(){
                        $(this).addClass("imgHover");
                        $(this).next('div').addClass("rotateImg");
                        $(this).css("opacity","0");
                    })
                    $("body").on("mouseover",function(e){
                        if(e.target.nodeName=="BODY"){
                        	$(".CarImg").removeClass("imgHover");
                            $(".RoleImg").removeClass("rotateImg");
                            $(".CarImg").css("opacity","1")
                        }              
                    })
                  },
                  error:function(e){
                    alert("程序出错请重试！")
                  }
                })
                $("#no_role").modal();
              }
            },
            error:function(){
              alert("查询失败！请重新加入")
            }
          })
        }else{
          alert("登录跳转失败！请重新登录")
          window.location.href=dev_location;
        }  
      });
      //点击加入队伍按钮
      $(".allRoleContainer").on("click",".Join_Team",function(e){
        e.preventDefault();
        JoinTeam.bind(this)();
      })
      //点击查看属性按钮
      $(".allRoleContainer").on("click",".Look_Role",function(e){
        e.preventDefault();
        LookRole.bind(this)();
      })
      function JoinTeam(){
        var me=this;
        var joinCarId=$(this).parents(".hasParent")[0].id;
        if($.inArray(joinCarId,hasCarId)!=-1){
          alert("你已经拥有此人物，请不要重复添加")
        }else{
          var carid={"uName":uName,"carid":joinCarId};
          $.ajax({
            type:"POST",
            data:carid,
            url :"joinTeam.php",
            success:function(e){
              
              if(e=="success"){
                var str="<h1 style='color:#fff;margin:20px auto;text-align:center;'>恭喜获得</h1>"
                str+="<img src='../images/showAllRole/"+carid['carid']+".jpg'>";
                $("#buy_success").html(str)
                /*防止用户点击多次重复购买*/
                $(me).addClass("disabled");
                $("#buy_success img").animate({ 
                    width: "100%",
                    height: "90%",
                    left:"+50px"
                }, 1000 );
                $("#buy_success img").animate({ 
                    left:"0px"
                }, 1000 );
                $('#myModal').modal()
              }else if(e=="NoMoeny"){
                alert("您的账户余额不足购买此人物")
              }else{
                alert("购买失败！")
              }
            },
            error:function(){
              alert("查询失败！请重新加入")
            }
          })
        }
      }
      function LookRole(){
        var me=this;
        var lookCarId=$(this).parents(".hasParent")[0].id;
        var carid={"uName":uName,"carid":lookCarId};
        $.ajax({
            type:"POST",
            data:carid,
            url :"lookRole.php",
            success:function(e){
                var data = JSON.parse(e);
                var str="<h1 style='color:#fff;margin:20px auto;text-align:center;'>人物介绍</h1>"
                str+="<img src='../images/showAllRole/"+carid['carid']+".jpg' style='float:left;margin-right:10px;'>";
                str+="<div style='color:#fff;'><h3 style='color:aqua;'>人物故事</h3>"+data.rolestory+"<h3 style='color:aqua;'>人物技能</h3>"+data.rolestory+"</div>";
                $("#lookRole_Dal").html(str);
                $('#lookRoleDal').modal()
                $(".modal-backdrop.in").css("opacity","0.8")
            },
            error:function(){
              alert("查询失败！请重新加入")
            }
        })
      }
      //hover左边导航进行提示的信息
      $('#P_message').tooltip();
      $('#P_team').tooltip();
      $('#P_chip').tooltip();
      $('#P_gem').tooltip();
      $('#P_battle').tooltip();
      $('#P_index').tooltip();
      $('#P_gift').tooltip();
      $('#P_refresh').tooltip();
      $('#P_sunglasses').tooltip();
      $('#P_book').tooltip();

      //点击导航展示详细的信息
      $("#P_message").click(function(){//个人信息
        $("#show_userMessage").modal();
        if(uName!=''){
          $.ajax({
            type:"POST",
            data:data,
            url :"sqlUserMessage.php",
            success:function(e){
              var allMessage=JSON.parse(e);
              if(allMessage.carid==null){
                $("#sql_Team").html();
              }else{
                var length=allMessage.carid.split(",").length;
                $("#sql_Team").html(parseInt(length)-1);
              }
              $("#sql_name").html(data.uName);
              $("#sql_V").html(allMessage.user_v);
              $("#sql_power").html(allMessage.user_power);
              $("#sql_acount").html(allMessage.user_money);
              $("#sql_title").html(allMessage.user_title);
              $("#sql_combat").html(allMessage.user_combat);
            },
            error:function(){
              alert("查询失败！请重新查询")
            }
          })
        }else{
          alert("登录跳转失败！请重新登录")
          window.location.href=dev_location;
        }  
      })
      $("#P_team").click(function(){//个人队伍
        $("#show_userTeam").modal();
        var str='';
        if(uName!=''){
          $.ajax({
            type:"POST",
            data:data,
            url :"selectRole.php",
            success:function(e){
              var carId=JSON.parse(e);
              if(carId.carid!=null){
                var allId=carId.carid.split(",");
              }else{
                $("#all_userTeam").html("<img src='../images/other/nochip01.jpg'><h3>您当前还未添加任何人物...</h3>")
                return;
              }
              
              hasCarId=allId;
              if(allId.length==1){
                $("#all_userTeam").html("<img src='../images/other/nochip01.jpg'><h3>您当前还未添加任何人物...</h3>")
                return;
              }
              if(allId!=null){
                $.ajax({
                  type:"POST",
                  data:{"uName":uName,"carId":allId},
                  url :"showCurrentRole.php",
                  success:function(e){
                    debugger;
                    var data=JSON.parse(e);
                    var roleData;
                    for(var i=0;i<allId.length;i++){
                      if(i!=0){
                        for(var k=0;k<data.length;k++){
                          if(data[k]['roleid']==allId[i]){
                            roleData=data[k];
                            break;
                          }
                        }
                        str+="<div class='col-sm-6 col-md-4'>"+
                                "<div class='thumbnail'>"+
                                  "<img src='../images/showRole/"+allId[i]+".png'/>"+
                                  "<div class='caption' style='text-align:center;'>"+
                                    "<p>攻击力："+roleData.roleattack+"</p>"+
                                    "<p>防御力："+roleData.roledefense+"</p>"+
                                    "<p>生命值："+roleData.rolelife+"</p>"+
                                  "</div>"+
                                "</div>"+
                              "</div>"
                      }
                    }
                    $("#all_userTeam").html("<h3>我的队伍信息</h3>"+str)
                  },
                  error:function(){
                    alert("查询失败！请重新查询")
                  }
                })
                
              }
            },
            error:function(){
              alert("查询失败！请重新查询")
            }
          })
        }else{
          alert("登录跳转失败！请重新登录")
          window.location.href=dev_location;
        }  
      })
      $("#P_chip").click(function(){//个人碎片
        $("#show_userChip").modal();
        if(uName!=''){
          $.ajax({
            type:"POST",
            data:data,
            url :"sqlMyChip.php",
            success:function(e){
              var sqlMyChip=JSON.parse(e);
              var allChip=sqlMyChip.message;//保存碎片的信息
              var str='';//保存展示的碎片的图片
              var objisNUll=true;
              for(var i=0;i<allChip.length;i++){
                if(allChip[i].rolechip!=null&&allChip[i].rolechip!=0){
                    objisNUll=false;
                    str+="<div class='col-sm-6 col-md-4' style='margin:0px'>"+
                          "<div class='thumbnail'>"+
                            "<img src='../images/showRole/"+allChip[i].roleid+".png'>"+
                            "<div class='caption'>"+
                              "<h3>碎片数量：<span id='"+allChip[i].roleid+"'>"+allChip[i].rolechip+"</span></h3>"+
                              "<p><a class='btn btn-primary intensify' role='button'>强化</a></p>"+
                            "</div>"+
                          "</div>"+
                          "</div>"
                }
              }
              if(objisNUll){
                str="<div class='jumbotron' style='margin-bottom:0'>"+
                        "<img src='../images/other/nochip01.jpg'>"+
                        "<h3>您目前还未获得任何碎片</h3>"+
                      "</div>"
                $("#sql_showAllChip").html(str);
              }else{
                $("#sql_showAllChip").html("<h3>我的碎片信息</h3>"+str);
              }
              $(".intensify").on("click",function(e){
                e.preventDefault();
                var roleId=$(this).parent().siblings("h3").children()[0].id;
                var chipNum=$(this).parent().siblings("h3").children()[0].innerHTML;
                var data={"uName":uName,"roleid":roleId};
                $.ajax({
                  type:"POST",
                  data:data,
                  url :"intensify.php",
                  success:function(e){
                    if(e=="success"){
                      alert("强化成功!");
                      location.reload();
                    }
                  },
                  error:function(e){}
                })
              })
            },
            error:function(){
              alert("查询失败！请重新查询")
            }
          })
        }else{
          alert("登录跳转失败！请重新登录")
          window.location.href=dev_location;
        }  
      })

      $("#P_gem").click(function(){//个人金币
        $("#show_userGem").modal();
        if(uName!=''){
          $.ajax({
            type:"POST",
            data:data,
            url :"sqlUserMessage.php",
            success:function(e){
              var sqlMyMoney=JSON.parse(e);
              if(sqlMyMoney.user_money!=null){
                $("#sql_showAllMoney").html(sqlMyMoney.user_money);
              }else{
                 $("#sql_showAllMoney").html(0);
              }
              
            },
            error:function(){
              alert("查询失败！请重新查询")
            }
          })
        }else{
          alert("登录跳转失败！请重新登录")
          window.location.href=dev_location;
        }  
      });
      $("#P_battle").click(function(){//进入选择战斗模式
        window.location.href=dev_location+"mainApp/selectModal.html?UFO"+Math.ceil(Math.random()*520)+'_'+decToHex(uName);
      })
      $('#P_index').click(function(){//返回登录页
        window.location.href=dev_location;
      })
      $('#P_gift').click(function(){//登录神秘商店
          $.ajax({
            type:"POST",
            data:data,
            url :"selectRole.php",
            success:function(e){
              var carId=JSON.parse(e);
              if(carId.carid!=null){
                var allId=carId.carid.split(",");
                hasCarId=allId;
                if(hasCarId.length==1){
                  $("#no_role").modal();
                  return;
                }
                $.ajax({
                  type:"POST",
                  data:data,
                  url :"showAllRole.php",
                  success:function(e){
                    var data=JSON.parse(e);
                    var str='';
                    for(var i=0;i<data.length;i++){
                      if($.inArray(data[i].id,allId)==-1&&data[i].tradeprice>6300){
                        str+='<div class="col-sm-6 col-md-4 hasParent" id='+data[i].roleid+'>'+
                              '<div class="thumbnail outCarImg">'+
                                '<img src="../images/showAllRole/'+data[i].roleid+'.jpg" class="img-responsive CarImg">'+
                                '<div class="caption RoleImg">'+
                                  '<h3 style="color:#fff;">'+data[i].rolename+'</h3>'+
                                  '<p>'+
                                    '<h5 style="color:#fff;">攻击：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roleattack+'%">'+data[i].roleattack+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">防御：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roledefense+'%">'+data[i].roledefense+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">生命值：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].rolelife/10+'%">'+data[i].rolelife+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">交易价：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].tradeprice/100+'%">'+data[i].tradeprice+'</div></div>'+
                                    '</h5>'+
                                  '</p>'+
                                  '<p>'+
                                    '<a href="#" class="btn btn-primary Join_Team" role="button" >加入队伍</a>'+ 
                           		    '<a href="#" class="btn btn-danger Look_Role" role="button" style="margin-left:20px;">查看属性</a>'+
                                  '</p>'+
                                '</div>'+
                              '</div>'+
                            '</div>'
                      }
                    }
                    $(".allRoleContainer").html(str);
                    /*增加条形动画*/
                    $(".progress-bar").hover(function(){
                      $(this).addClass("active")
                    },function(){
                      $(this).removeClass("active")
                    })
                     /*翻拍效果*/
                    $(".allRoleContainer").on("mouseover",".CarImg",function(){
                        $(this).addClass("imgHover");
                        $(this).next('div').addClass("rotateImg");
                        $(this).css("opacity","0");
                    })
                    $("body").on("mouseover",function(e){
                        if(e.target.nodeName=="BODY"){
                        	$(".CarImg").removeClass("imgHover");
                            $(".RoleImg").removeClass("rotateImg");
                            $(".CarImg").css("opacity","1")
                        }              
                    })
                  },
                  error:function(e){
                    alert("程序出错请重试！")
                  }
                })
              }else{
                $.ajax({
                  type:"POST",
                  data:data,
                  url :"showAllRole.php",
                  success:function(e){
                    var data=JSON.parse(e);
                    var str='';
                    for(var i=0;i<data.length;i++){
                      if(data[i].tradeprice>6300){
                        str+='<div class="col-sm-6 col-md-4 hasParent" id='+data[i].roleid+'>'+
                              '<div class="thumbnail outCarImg">'+
                                '<img src="../images/showAllRole/'+data[i].roleid+'.jpg" class="img-responsive CarImg">'+
                                '<div class="caption RoleImg">'+
                                  '<h3 style="color:#fff;">'+data[i].rolename+'</h3>'+
                                  '<p>'+
                                    '<h5 style="color:#fff;">攻击：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roleattack+'%">'+data[i].roleattack+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">防御：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].roledefense+'%">'+data[i].roledefense+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">生命值：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"  style="max-width:100%;width:'
                                    +data[i].rolelife/10+'%">'+data[i].rolelife+'</div></div>'+
                                    '</h5>'+
                                    '<h5 style="color:#fff;">交易价：'+
                                    '<div class="progress" >'+
                                    '<div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"  style="min-width: 2em;width:'
                                    +data[i].tradeprice/100+'%">'+data[i].tradeprice+'</div></div>'+
                                    '</h5>'+
                                  '</p>'+
                                  '<p>'+
                                    '<a href="#" class="btn btn-primary Join_Team" role="button" >加入队伍</a>'+ 
                            		'<a href="#" class="btn btn-danger Look_Role" role="button" style="margin-left:20px;">查看属性</a>'+
                                  '</p>'+
                                '</div>'+
                              '</div>'+
                            '</div>'
                      }
                    }
                    $(".allRoleContainer").html(str);
                     /*增加条形动画*/
                    $(".progress-bar").hover(function(){
                      $(this).addClass("active")
                    },function(){
                      $(this).removeClass("active")
                    })
                     /*翻拍效果*/
                    $(".allRoleContainer").on("mouseover",".CarImg",function(){
                        $(this).addClass("imgHover");
                        $(this).next('div').addClass("rotateImg");
                        $(this).css("opacity","0");
                    })
                    $("body").on("mouseover",function(e){
                        if(e.target.nodeName=="BODY"){
                        	$(".CarImg").removeClass("imgHover");
                            $(".RoleImg").removeClass("rotateImg");
                            $(".CarImg").css("opacity","1")
                        }              
                    })
                  },
                  error:function(e){
                    alert("程序出错请重试！")
                  }
                })
                $("#no_role").modal();
              }
            },
            error:function(){
              alert("查询失败！请重新加入")
            }
          })
      })
      $('#P_refresh').click(function(){//刷新页面
        window.location.reload();
      })
      $('#P_sunglasses').click(function(){//进入抽奖
        $("#show_lottery").modal();

      })
        /*点击一次抽一次*/
        $("#lottery1").click(function(){
          if($(".html-Append").length>0){
            $(".html-Append").remove();
          }
          $.ajax({
            type:"POST",
            data:data,
            url :"lottery1.php",
            success:function(e){
              if(e=="error"){
                alert("当前用户余额不足本次抽奖！");
                return;
              }else if(e=="rolenum0"){
                alert("请先购买人物后再进行抽奖！");
                return;
              }else{
                $("#lottery10").addClass('disabled');
                $("#lottery1").addClass('disabled');
                var data=JSON.parse(e);
                var str="<div class='col-sm-6 col-md-4 html-Append' style='margin:0px'>"+
                          "<div class='thumbnail'>"+
                            "<img src='../images/showRole/"+data.carid+".png'>"+
                            "<div class='caption'>"+
                              "<h3>碎片数量：<span id='"+data.carid+"'>"+data.randNum+"</span></h3>"+
                            "</div>"+
                          "</div>"+
                          "</div>"
                $("#sql_lottery").append(str);
                $(".html-Append img").animate({ 
                  opacity:"1"
                },1000 );
                $(".html-Append img").css("transform","rotateY(360deg)")
                $(".html-Append img").css("box-shadow","0 0 50px blue")
              }
              $("#lottery10").removeClass('disabled');
              $("#lottery1").removeClass('disabled');
            },
            error:function(){
              alert("出错请重试！")
            }
          })
        });
        /*点击抽十次*/
        $("#lottery10").click(function(){
          if($(".html-Append").length>0){
            $(".html-Append").remove();
          }
          $.ajax({
            type:"POST",
            data:data,
            url :"lottery10.php",
            success:function(e){
              if(e=="error"){
                alert("当前用户余额不足本次抽奖！");
                return;
              }else if(e=="rolenum0"){
                alert("请先购买人物后再进行抽奖！");
                return;
              }else{
                $("#lottery10").addClass('disabled');
                $("#lottery1").addClass('disabled');
                var data=JSON.parse(e);
                var str='';
                var i=0;
                var timer=setInterval(function(){
                  if(i<10){
                    $("#sql_lottery").append(
                      "<div class='col-sm-6 col-md-4 html-Append' style='margin:0px'>"+
                            "<div class='thumbnail'>"+
                              "<img src='../images/showRole/"+data['carid'][i]+".png'>"+
                              "<div class='caption'>"+
                                "<h3>碎片数量：<span id='"+data['carid'][i]+"'>"+data['randNum'][i]+
                                "</span></h3>"+
                              "</div>"+
                            "</div>"+
                            "</div>"
                    );
                    $(".html-Append img").animate({ 
                      opacity:"1",
                      scale:"2"
                    }, 1000 );
                    $(".html-Append img").css("transform","rotateY(360deg)")
                    $(".html-Append img").css("box-shadow","0 0 50px blue")
                  }else{
                    clearInterval(timer);
                    $("#lottery10").removeClass('disabled');
                    $("#lottery1").removeClass('disabled');
                  }
                  i++;
                },1000)


              }
            },
            error:function(){
              alert("出错请重试！")
            }
          })
        })
      $('#P_book').click(function(){
          $("#show_book").modal();
      })
      $("#payToWeiXin").click(function(e){
        e.preventDefault();
        var ImgSrc=document.getElementById('payImg');
        ImgSrc.src='../images/other/payweixin.jpg';
      })
    </script>
  </body>
</html>